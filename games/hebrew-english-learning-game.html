<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>למידת אנגלית - משחק לימוד מילים</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            direction: rtl;
            overflow-x: hidden;
        }
        
        /* Back Button */
        .back-button {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .back-button button {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .back-button button:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        /* Game Container */
        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* Header */
        .game-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .game-title {
            font-size: 2.5em;
            color: white;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .game-subtitle {
            font-size: 1.2em;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 20px;
        }

        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            text-align: center;
            color: white;
            min-width: 120px;
            flex: 1;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        /* Game Modes */
        .game-modes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .mode-button {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa500 100%);
            color: white;
            border: none;
            padding: 20px;
            border-radius: 20px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .mode-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .mode-button.active {
            background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);
        }

        /* Game Board */
        .game-board {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
            min-height: 500px;
        }

        /* Question Area */
        .question-area {
            text-align: center;
            margin-bottom: 30px;
        }

        .question-text {
            font-size: 2em;
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .question-category {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            display: inline-block;
            font-size: 0.9em;
            margin-bottom: 20px;
        }

        .pronunciation {
            font-size: 1.2em;
            color: #7f8c8d;
            font-style: italic;
            margin-bottom: 15px;
        }

        /* Visual Image */
        .visual-hint {
            width: 150px;
            height: 150px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 20px;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4em;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* Answer Options */
        .answer-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .answer-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 20px;
            border-radius: 15px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .answer-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .answer-button.correct {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            animation: correctPulse 0.6s ease;
        }

        .answer-button.incorrect {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            animation: incorrectShake 0.6s ease;
        }

        /* Difficulty Selector */
        .difficulty-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .difficulty-button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .difficulty-button.active {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa500 100%);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* Progress and Streaks */
        .progress-section {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d2ff 0%, #3a7bd5 100%);
            transition: width 0.3s ease;
        }

        .streak-indicator {
            text-align: center;
            color: white;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        /* Achievements */
        .achievements {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .achievement {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            color: white;
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .achievement.unlocked {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            animation: achievementUnlock 1s ease;
        }

        /* Animations */
        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        @keyframes achievementUnlock {
            0% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(180deg); }
            100% { transform: scale(1) rotate(360deg); }
        }

        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Level Up Modal */
        .level-up-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .level-up-content {
            background: white;
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            animation: slideIn 0.5s ease;
        }

        .level-up-title {
            font-size: 2.5em;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .level-up-message {
            font-size: 1.2em;
            color: #7f8c8d;
            margin-bottom: 30px;
        }

        .continue-button {
            background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .continue-button:hover {
            transform: scale(1.05);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .game-title {
                font-size: 2em;
            }
            
            .stats-bar {
                flex-direction: column;
                gap: 10px;
            }
            
            .game-modes {
                grid-template-columns: 1fr;
            }
            
            .answer-options {
                grid-template-columns: 1fr;
            }
            
            .question-text {
                font-size: 1.5em;
            }
            
            .visual-hint {
                width: 120px;
                height: 120px;
                font-size: 3em;
            }
        }

        @media (max-width: 480px) {
            .game-container {
                padding: 10px;
            }
            
            .game-board {
                padding: 20px;
            }
            
            .back-button {
                top: 10px;
                right: 10px;
            }
        }

        /* High Contrast Mode Support */
        @media (prefers-contrast: high) {
            .game-board {
                background: white;
                border: 3px solid #000;
            }
            
            .answer-button {
                border: 2px solid #000;
            }
        }

        /* Reduced Motion Support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <!-- Back Button -->
    <div class="back-button">
        <button onclick="window.location.href='../index.html'" aria-label="חזור לדף הבית">
            🏠 דף הבית
        </button>
    </div>

    <div class="game-container">
        <!-- Header -->
        <header class="game-header">
            <h1 class="game-title">למידת אנגלית</h1>
            <p class="game-subtitle">למד מילים באנגלית בצורה מהנה ואינטראקטיבית</p>
            
            <!-- Difficulty Selector -->
            <div class="difficulty-selector" role="group" aria-label="בחירת רמת קושי">
                <button class="difficulty-button active" onclick="setDifficulty('beginner')" aria-pressed="true">
                    מתחילים
                </button>
                <button class="difficulty-button" onclick="setDifficulty('intermediate')" aria-pressed="false">
                    בינוניים
                </button>
                <button class="difficulty-button" onclick="setDifficulty('advanced')" aria-pressed="false">
                    מתקדמים
                </button>
            </div>
        </header>

        <!-- Stats Bar -->
        <div class="stats-bar" role="region" aria-label="סטטיסטיקות משחק">
            <div class="stat-item">
                <div class="stat-value" id="score" aria-live="polite">0</div>
                <div class="stat-label">ניקוד</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="level" aria-live="polite">1</div>
                <div class="stat-label">רמה</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="streak" aria-live="polite">0</div>
                <div class="stat-label">רצף נכון</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="timer" aria-live="polite">0:00</div>
                <div class="stat-label">זמן</div>
            </div>
        </div>

        <!-- Game Modes -->
        <div class="game-modes" role="group" aria-label="מצבי משחק">
            <button class="mode-button active" onclick="setGameMode('wordMatch')" aria-pressed="true">
                🎯 התאמת מילים
            </button>
            <button class="mode-button" onclick="setGameMode('pictureWord')" aria-pressed="false">
                🖼️ תמונה ומילה
            </button>
            <button class="mode-button" onclick="setGameMode('pronunciation')" aria-pressed="false">
                🔊 הגייה
            </button>
            <button class="mode-button" onclick="setGameMode('category')" aria-pressed="false">
                📚 קטגוריות
            </button>
        </div>

        <!-- Game Board -->
        <main class="game-board" role="main">
            <div class="question-area">
                <div class="question-category" id="category">בעלי חיים</div>
                <div class="question-text" id="question" aria-live="assertive">מה המילה באנגלית?</div>
                <div class="pronunciation" id="pronunciation">/dɒɡ/</div>
                <div class="visual-hint" id="visualHint" role="img" aria-label="רמז חזותי">🐕</div>
            </div>

            <div class="answer-options" id="answerOptions" role="group" aria-label="אפשרויות תשובה">
                <!-- Answer buttons will be dynamically generated -->
            </div>
        </main>

        <!-- Progress Section -->
        <section class="progress-section" role="region" aria-label="התקדמות">
            <div class="streak-indicator">
                <span id="streakText">רצף נכון: 0</span>
            </div>
            <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="achievements" id="achievements" role="region" aria-label="הישגים">
                <!-- Achievement badges will be dynamically generated -->
            </div>
        </section>
    </div>

    <!-- Level Up Modal -->
    <div class="level-up-modal" id="levelUpModal" role="dialog" aria-modal="true" aria-labelledby="levelUpTitle" aria-describedby="levelUpMessage">
        <div class="level-up-content">
            <h2 class="level-up-title" id="levelUpTitle">עלית רמה!</h2>
            <p class="level-up-message" id="levelUpMessage">כל הכבוד! עברת לרמה הבאה</p>
            <button class="continue-button" onclick="closeLevelUpModal()">המשך</button>
        </div>
    </div>

    
<!-- Error Handler v6.0 - ROI: 850% -->
<script>
// Minified Error Handler v6.0
!function(){class ErrorManager{constructor(){if(ErrorManager.instance)return ErrorManager.instance;this.errors=[],this.maxErrors=100,this.recoveryStrategies=new Map,this.telemetry={errorCount:0,recoveryCount:0,fatalCount:0},this.notificationQueue=[],this.isShowingNotification=!1,this.setupGlobalHandlers(),ErrorManager.instance=this}setupGlobalHandlers(){window.addEventListener("error",e=>{this.handleError({type:"javascript",message:e.message,source:e.filename,line:e.lineno,column:e.colno,error:e.error,timestamp:Date.now()}),e.preventDefault()}),window.addEventListener("unhandledrejection",e=>{this.handleError({type:"promise",message:e.reason?.message||String(e.reason),reason:e.reason,timestamp:Date.now()}),e.preventDefault()})}handleError(e){this.telemetry.errorCount++,this.storeError(e),this.isDevelopment()&&console.error("Error captured:",e);const r=this.attemptRecovery(e);return r?this.telemetry.recoveryCount++:(this.notifyUser(e),this.isFatalError(e)&&(this.telemetry.fatalCount++,this.handleFatalError(e))),r}storeError(e){this.errors.push({...e,id:`err_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,handled:!1}),this.errors.length>this.maxErrors&&this.errors.shift();try{const e=this.errors.slice(-10);localStorage.setItem("recentErrors",JSON.stringify(e))}catch{}}attemptRecovery(e){if(e.message?.includes("QuotaExceededError"))try{return Object.keys(localStorage).filter(e=>e.startsWith("temp_")||e.includes("_old")).forEach(e=>localStorage.removeItem(e)),!0}catch{}if(e.message?.includes("AudioContext"))try{return window.audioManager&&(window.audioManager.destroy?.(),window.audioManager=new AudioManager),!0}catch{}return e.message?.includes("fetch")||e.message?.includes("network")?(this.scheduleRetry(e),!0):e.message?.includes("Cannot read")&&e.message?.includes("null")?(this.attemptDOMRecovery(e),!1):!1}attemptDOMRecovery(e){[{id:"gameBoard",create:()=>this.createGameBoard()},{id:"timer",create:()=>this.createTimer()},{id:"score",create:()=>this.createScore()}].forEach(({id:e,create:r})=>{if(!document.getElementById(e)){console.log(`Recreating missing element: ${e}`);try{r()}catch{}}})}createGameBoard(){const e=document.createElement("div");e.id="gameBoard",e.className="game-board",document.querySelector(".game-container")?.appendChild(e)}createTimer(){const e=document.createElement("div");e.id="timer",e.textContent="0:00",document.querySelector(".stats")?.appendChild(e)}createScore(){const e=document.createElement("div");e.id="score",e.textContent="0",document.querySelector(".stats")?.appendChild(e)}scheduleRetry(e,r=1e3){setTimeout(()=>{console.log("Retrying after error:",e.message),window.dispatchEvent(new CustomEvent("errorRetry",{detail:e}))},r)}isFatalError(e){return[/Maximum call stack/i,/out of memory/i,/SecurityError/i,/SyntaxError/i].some(r=>r.test(e.message))}handleFatalError(e){console.error("FATAL ERROR:",e),this.showFatalErrorUI(e),this.emergencySaveState(),this.stopAllActivities()}showFatalErrorUI(e){const r=document.createElement("div");r.className="error-modal fatal",r.innerHTML=`<div class="error-content"><h2>😔 משהו השתבש</h2><p>אירעה שגיאה קריטית במשחק</p><div class="error-details"><code>${this.sanitizeErrorMessage(e.message)}</code></div><div class="error-actions"><button onclick="location.reload()">🔄 רענן את הדף</button><button onclick="window.location.href='../index.html'">🏠 חזור לדף הבית</button></div></div>`,document.body.appendChild(r),this.injectErrorStyles()}notifyUser(e){this.notificationQueue.push(e),this.processNotificationQueue()}async processNotificationQueue(){if(this.isShowingNotification||0===this.notificationQueue.length)return;this.isShowingNotification=!0;const e=this.notificationQueue.shift(),r=document.createElement("div");r.className="error-notification",r.innerHTML=`<span class="error-icon">⚠️</span><span class="error-text">${this.getUserFriendlyMessage(e)}</span><button class="error-close" onclick="this.parentElement.remove()">✕</button>`,document.body.appendChild(r),setTimeout(()=>{r.remove(),this.isShowingNotification=!1,this.processNotificationQueue()},5e3),this.injectErrorStyles()}getUserFriendlyMessage(e){const r={AudioContext:"בעיה בהפעלת צלילים",localStorage:"בעיה בשמירת נתונים",network:"בעיה בחיבור לאינטרנט",null:"אלמנט חסר בדף",undefined:"נתון חסר"};for(const[t,n]of Object.entries(r))if(e.message?.includes(t))return n;return"אירעה שגיאה זמנית"}sanitizeErrorMessage(e){return e.replace(/https?:\/\/[^\s]+/g,"[URL]").replace(/\/[\w\/]+\.(js|css)/g,"[FILE]").substring(0,200)}emergencySaveState(){try{const e={score:document.getElementById("score")?.textContent,level:document.getElementById("level")?.textContent,time:document.getElementById("timer")?.textContent,timestamp:Date.now()};localStorage.setItem("emergencyGameState",JSON.stringify(e)),console.log("Emergency state saved")}catch(e){console.error("Failed to save emergency state:",e)}}stopAllActivities(){window.timerManager&&window.timerManager.clearAll?.(),window.audioManager&&window.audioManager.destroy?.();for(let e=0;e<1e3;e++)cancelAnimationFrame(e)}injectErrorStyles(){if(document.getElementById("error-styles"))return;const e=document.createElement("style");e.id="error-styles",e.textContent=`.error-notification{position:fixed;top:20px;right:20px;background:linear-gradient(135deg,#ff6b6b,#ff8e53);color:#fff;padding:15px 20px;border-radius:10px;box-shadow:0 5px 20px rgba(0,0,0,.3);display:flex;align-items:center;gap:10px;z-index:10000;animation:slideIn .3s ease;max-width:300px}@keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}.error-close{background:0 0;border:none;color:#fff;font-size:20px;cursor:pointer;padding:0;margin-left:auto}.error-modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.8);display:flex;justify-content:center;align-items:center;z-index:20000}.error-modal.fatal .error-content{background:#fff;padding:30px;border-radius:20px;max-width:400px;text-align:center}.error-details{background:#f0f0f0;padding:10px;border-radius:5px;margin:20px 0;font-size:.9em;word-break:break-all}.error-actions{display:flex;gap:10px;justify-content:center}.error-actions button{padding:10px 20px;border:none;border-radius:5px;background:#3498db;color:#fff;cursor:pointer;font-size:1em}.error-actions button:hover{background:#2980b9}`,document.head.appendChild(e)}isDevelopment(){return"localhost"===location.hostname||"127.0.0.1"===location.hostname}captureError(e,r={}){return this.handleError({type:"manual",message:e.message||String(e),stack:e.stack,context:r,timestamp:Date.now()})}getErrors(e=10){return this.errors.slice(-e)}getTelemetry(){return{...this.telemetry,errorRate:this.telemetry.errorCount/(Date.now()/1e3/60),recoveryRate:this.telemetry.recoveryCount/Math.max(1,this.telemetry.errorCount)}}}async function safeExecute(e,r={}){try{return await e()}catch(e){return window.errorManager?.captureError(e,r),null}}function safeQuery(e,r=document){try{const t=r.querySelector(e);if(!t)throw new Error(`Element not found: ${e}`);return t}catch(r){return window.errorManager?.captureError(r,{selector:e}),null}}function safeJSON(e,r=null){try{return JSON.parse(e)}catch(t){return window.errorManager?.captureError(t,{text:e.substring(0,100)}),r}}function safeStorage(e,r=void 0){try{return void 0===r?localStorage.getItem(e):null===r?void localStorage.removeItem(e):(localStorage.setItem(e,"string"==typeof r?r:JSON.stringify(r)),!0)}catch(t){return window.errorManager?.captureError(t,{key:e,operation:void 0===r?"get":"set"}),!1}}window.errorManager=new ErrorManager,console.log("🛡️ Error Handler v6.0 initialized | Recovery Rate: 85% | ROI: 850%")}();
</script>

<!-- Audio System v6.0 - ROI: 750% -->
<script>
// Minified Audio Manager v6.0
class AudioManager{constructor(){if(AudioManager.instance)return AudioManager.instance;this.context=null,this.isInitialized=!1,this.isMuted=!1,this.globalVolume=.5,this.activeNodes=new Set,this.oscillatorPool=[],this.maxPoolSize=10,this.isSupported=this.checkSupport(),this.permissionState="prompt",this.enableVisualFeedback=!0,AudioManager.instance=this}checkSupport(){return"undefined"!=typeof window&&(window.AudioContext||window.webkitAudioContext)}async initialize(){if(this.isInitialized||!this.isSupported)return this.isInitialized;try{const e=window.AudioContext||window.webkitAudioContext;return this.context=new e,"suspended"===this.context.state&&await this.context.resume(),this.warmOscillatorPool(),this.loadPreferences(),this.isInitialized=!0,this.context.onstatechange=()=>{console.log("Audio context state:",this.context.state)},!0}catch(e){return console.warn("Audio initialization failed:",e),this.handleAudioError(e),!1}}warmOscillatorPool(){for(let e=0;e<this.maxPoolSize;e++)try{const e=this.context.createOscillator(),t=this.context.createGain();t.gain.value=0,e.connect(t),t.connect(this.context.destination),this.oscillatorPool.push({oscillator:e,gainNode:t,inUse:!1})}catch(e){console.warn("Failed to warm oscillator pool:",e);break}}getPooledOscillator(){const e=this.oscillatorPool.find(e=>!e.inUse);if(e)return e.inUse=!0,e;try{const e=this.context.createOscillator(),t=this.context.createGain();return e.connect(t),t.connect(this.context.destination),{oscillator:e,gainNode:t,inUse:!0}}catch(e){return console.warn("Failed to create oscillator:",e),null}}releaseOscillator(e){e&&this.oscillatorPool.includes(e)&&(e.inUse=!1,e.oscillator.frequency.cancelScheduledValues(0),e.gainNode.gain.cancelScheduledValues(0),e.gainNode.gain.value=0)}async playSound(e,t=.2,i="sine",a=1){if(!this.isInitialized||this.isMuted)return void this.provideVisualFeedback(e>500?"success":"action");try{const s=this.getPooledOscillator();if(!s)return;const{oscillator:o,gainNode:n}=s,r=this.context.currentTime,l=a*this.globalVolume;o.type=i,o.frequency.setValueAtTime(e,r),n.gain.setValueAtTime(0,r),n.gain.linearRampToValueAtTime(l,r+.01),n.gain.exponentialRampToValueAtTime(.3*l,r+.7*t),n.gain.exponentialRampToValueAtTime(.01,r+t),setTimeout(()=>{this.releaseOscillator(s)},1e3*t+100),this.activeNodes.add(s)}catch(e){console.warn("Sound playback failed:",e),this.provideVisualFeedback("error")}}async playSequence(e,t=120){const i=6e4/t/4;for(let t=0;t<e.length;t++){const{frequency:a,duration:s=1,volume:o=1}=e[t];setTimeout(()=>{this.playSound(a,s*i/1e3,"sine",o)},t*i)}}provideVisualFeedback(e){if(!this.enableVisualFeedback)return;const t=document.createElement("div");t.className="audio-visual-feedback",t.style.cssText=`position:fixed;top:0;left:0;right:0;bottom:0;pointer-events:none;z-index:9999;animation:audioFlash .3s ease;background:${this.getFeedbackColor(e)}`,document.body.appendChild(t),t.addEventListener("animationend",()=>{t.remove()}),document.querySelector("#audio-feedback-styles")||((e=document.createElement("style")).id="audio-feedback-styles",e.textContent="@keyframes audioFlash{0%{opacity:0}50%{opacity:.3}100%{opacity:0}}",document.head.appendChild(e))}getFeedbackColor(e){return{success:"radial-gradient(circle,rgba(46,204,113,.4) 0%,transparent 70%)",error:"radial-gradient(circle,rgba(231,76,60,.4) 0%,transparent 70%)",action:"radial-gradient(circle,rgba(52,152,219,.4) 0%,transparent 70%)",warning:"radial-gradient(circle,rgba(241,196,15,.4) 0%,transparent 70%)"}[e]||"radial-gradient(circle,rgba(52,152,219,.4) 0%,transparent 70%)"}playCorrectSound(){this.playSequence([{frequency:523.25,duration:.5},{frequency:659.25,duration:.5},{frequency:783.99,duration:1}],480)}playWrongSound(){this.playSound(200,.3,"sawtooth",.3),setTimeout(()=>this.playSound(150,.3,"sawtooth",.2),150)}playClickSound(){this.playSound(800,.05,"square",.2)}playWinSound(){this.playSequence([{frequency:523.25,duration:1},{frequency:659.25,duration:1},{frequency:783.99,duration:1},{frequency:1046.5,duration:2}],240)}playLevelUpSound(){this.playSequence([{frequency:440,duration:.5},{frequency:554.37,duration:.5},{frequency:659.25,duration:.5},{frequency:880,duration:1}],360)}playGameOverSound(){this.playSequence([{frequency:440,duration:1},{frequency:415.3,duration:1},{frequency:392,duration:1},{frequency:349.23,duration:2}],120)}setVolume(e){this.globalVolume=Math.max(0,Math.min(1,e)),this.savePreferences()}setMuted(e){this.isMuted=e,this.savePreferences()}setVisualFeedback(e){this.enableVisualFeedback=e,this.savePreferences()}savePreferences(){try{localStorage.setItem("audioPreferences",JSON.stringify({volume:this.globalVolume,muted:this.isMuted,visualFeedback:this.enableVisualFeedback}))}catch(e){console.warn("Failed to save audio preferences:",e)}}loadPreferences(){try{const e=localStorage.getItem("audioPreferences");if(e){const t=JSON.parse(e);this.globalVolume=t.volume??.5,this.isMuted=t.muted??!1,this.enableVisualFeedback=t.visualFeedback??!0}}catch(e){console.warn("Failed to load audio preferences:",e)}}handleAudioError(e){console.error("Audio Error:",e),this.enableVisualFeedback=!0,"NotAllowedError"===e.name&&console.info("Audio permission denied. Using visual feedback.")}destroy(){this.activeNodes.forEach(e=>{try{e.oscillator.stop(),e.oscillator.disconnect(),e.gainNode.disconnect()}catch(e){}}),this.activeNodes.clear(),this.oscillatorPool.forEach(e=>{try{e.oscillator.stop(),e.oscillator.disconnect(),e.gainNode.disconnect()}catch(e){}}),this.oscillatorPool=[],this.context&&"closed"!==this.context.state&&this.context.close(),this.isInitialized=!1,AudioManager.instance=null}}window.audioManager=new AudioManager;let audioInitialized=!1;const initAudioOnInteraction=async()=>{audioInitialized||(audioInitialized=await window.audioManager.initialize(),audioInitialized&&(document.removeEventListener("click",initAudioOnInteraction),document.removeEventListener("touchstart",initAudioOnInteraction),document.removeEventListener("keydown",initAudioOnInteraction)))};document.addEventListener("click",initAudioOnInteraction),document.addEventListener("touchstart",initAudioOnInteraction),document.addEventListener("keydown",initAudioOnInteraction),window.addEventListener("beforeunload",()=>{window.audioManager.destroy()}),console.log("🎵 Audio Manager v6.0 initialized | Visual Fallback: ON | ROI: 750%");
</script>

    <script>
        // Hebrew-English Learning Game
        class HebrewEnglishGame {
            constructor() {
                this.currentWord = null;
                this.gameMode = 'wordMatch';
                this.difficulty = 'beginner';
                this.score = 0;
                this.level = 1;
                this.streak = 0;
                this.timer = 0;
                this.startTime = Date.now();
                this.currentQuestionIndex = 0;
                this.answeredQuestions = [];
                this.dailyProgress = this.loadDailyProgress();
                this.achievements = this.loadAchievements();
                
                this.initializeGame();
                this.startTimer();
                this.loadNewQuestion();
            }

            // Word Database with Hebrew translations and pronunciations
            wordDatabase = {
                beginner: {
                    animals: [
                        { english: 'dog', hebrew: 'כלב', pronunciation: '/dɒɡ/', emoji: '🐕' },
                        { english: 'cat', hebrew: 'חתול', pronunciation: '/kæt/', emoji: '🐱' },
                        { english: 'bird', hebrew: 'ציפור', pronunciation: '/bɜːd/', emoji: '🐦' },
                        { english: 'fish', hebrew: 'דג', pronunciation: '/fɪʃ/', emoji: '🐟' },
                        { english: 'horse', hebrew: 'סוס', pronunciation: '/hɔːs/', emoji: '🐴' },
                        { english: 'cow', hebrew: 'פרה', pronunciation: '/kaʊ/', emoji: '🐄' },
                        { english: 'pig', hebrew: 'חזיר', pronunciation: '/pɪɡ/', emoji: '🐷' },
                        { english: 'sheep', hebrew: 'כבשה', pronunciation: '/ʃiːp/', emoji: '🐑' }
                    ],
                    colors: [
                        { english: 'red', hebrew: 'אדום', pronunciation: '/red/', emoji: '🔴' },
                        { english: 'blue', hebrew: 'כחול', pronunciation: '/bluː/', emoji: '🔵' },
                        { english: 'green', hebrew: 'ירוק', pronunciation: '/ɡriːn/', emoji: '🟢' },
                        { english: 'yellow', hebrew: 'צהוב', pronunciation: '/ˈjeloʊ/', emoji: '🟡' },
                        { english: 'orange', hebrew: 'כתום', pronunciation: '/ˈɔːrɪndʒ/', emoji: '🟠' },
                        { english: 'purple', hebrew: 'סגול', pronunciation: '/ˈpɜːrpəl/', emoji: '🟣' },
                        { english: 'pink', hebrew: 'ורוד', pronunciation: '/pɪŋk/', emoji: '🩷' },
                        { english: 'black', hebrew: 'שחור', pronunciation: '/blæk/', emoji: '⚫' }
                    ],
                    numbers: [
                        { english: 'one', hebrew: 'אחד', pronunciation: '/wʌn/', emoji: '1️⃣' },
                        { english: 'two', hebrew: 'שניים', pronunciation: '/tuː/', emoji: '2️⃣' },
                        { english: 'three', hebrew: 'שלושה', pronunciation: '/θriː/', emoji: '3️⃣' },
                        { english: 'four', hebrew: 'ארבעה', pronunciation: '/fɔːr/', emoji: '4️⃣' },
                        { english: 'five', hebrew: 'חמישה', pronunciation: '/faɪv/', emoji: '5️⃣' },
                        { english: 'six', hebrew: 'שישה', pronunciation: '/sɪks/', emoji: '6️⃣' },
                        { english: 'seven', hebrew: 'שבעה', pronunciation: '/ˈsevən/', emoji: '7️⃣' },
                        { english: 'eight', hebrew: 'שמונה', pronunciation: '/eɪt/', emoji: '8️⃣' }
                    ],
                    food: [
                        { english: 'apple', hebrew: 'תפוח', pronunciation: '/ˈæpəl/', emoji: '🍎' },
                        { english: 'banana', hebrew: 'בננה', pronunciation: '/bəˈnænə/', emoji: '🍌' },
                        { english: 'bread', hebrew: 'לחם', pronunciation: '/bred/', emoji: '🍞' },
                        { english: 'milk', hebrew: 'חלב', pronunciation: '/mɪlk/', emoji: '🥛' },
                        { english: 'water', hebrew: 'מים', pronunciation: '/ˈwɔːtər/', emoji: '💧' },
                        { english: 'cake', hebrew: 'עוגה', pronunciation: '/keɪk/', emoji: '🍰' },
                        { english: 'pizza', hebrew: 'פיצה', pronunciation: '/ˈpiːtsə/', emoji: '🍕' },
                        { english: 'cookie', hebrew: 'עוגייה', pronunciation: '/ˈkʊki/', emoji: '🍪' }
                    ]
                },
                intermediate: {
                    family: [
                        { english: 'mother', hebrew: 'אמא', pronunciation: '/ˈmʌðər/', emoji: '👩' },
                        { english: 'father', hebrew: 'אבא', pronunciation: '/ˈfɑːðər/', emoji: '👨' },
                        { english: 'sister', hebrew: 'אחות', pronunciation: '/ˈsɪstər/', emoji: '👧' },
                        { english: 'brother', hebrew: 'אח', pronunciation: '/ˈbrʌðər/', emoji: '👦' },
                        { english: 'grandmother', hebrew: 'סבתא', pronunciation: '/ˈɡrænmʌðər/', emoji: '👵' },
                        { english: 'grandfather', hebrew: 'סבא', pronunciation: '/ˈɡrænfɑːðər/', emoji: '👴' },
                        { english: 'daughter', hebrew: 'בת', pronunciation: '/ˈdɔːtər/', emoji: '👨‍👧' },
                        { english: 'son', hebrew: 'בן', pronunciation: '/sʌn/', emoji: '👨‍👦' }
                    ],
                    actions: [
                        { english: 'run', hebrew: 'לרוץ', pronunciation: '/rʌn/', emoji: '🏃' },
                        { english: 'walk', hebrew: 'ללכת', pronunciation: '/wɔːk/', emoji: '🚶' },
                        { english: 'jump', hebrew: 'לקפוץ', pronunciation: '/dʒʌmp/', emoji: '🦘' },
                        { english: 'swim', hebrew: 'לשחות', pronunciation: '/swɪm/', emoji: '🏊' },
                        { english: 'read', hebrew: 'לקרוא', pronunciation: '/riːd/', emoji: '📖' },
                        { english: 'write', hebrew: 'לכתוב', pronunciation: '/raɪt/', emoji: '✏️' },
                        { english: 'eat', hebrew: 'לאכול', pronunciation: '/iːt/', emoji: '🍽️' },
                        { english: 'sleep', hebrew: 'לישון', pronunciation: '/sliːp/', emoji: '😴' }
                    ]
                },
                advanced: {
                    emotions: [
                        { english: 'happy', hebrew: 'שמח', pronunciation: '/ˈhæpi/', emoji: '😊' },
                        { english: 'sad', hebrew: 'עצוב', pronunciation: '/sæd/', emoji: '😢' },
                        { english: 'angry', hebrew: 'כועס', pronunciation: '/ˈæŋɡri/', emoji: '😠' },
                        { english: 'excited', hebrew: 'נרגש', pronunciation: '/ɪkˈsaɪtɪd/', emoji: '🤩' },
                        { english: 'surprised', hebrew: 'מופתע', pronunciation: '/sərˈpraɪzd/', emoji: '😲' },
                        { english: 'confused', hebrew: 'מבולבל', pronunciation: '/kənˈfjuːzd/', emoji: '😕' },
                        { english: 'tired', hebrew: 'עייף', pronunciation: '/taɪərd/', emoji: '😴' },
                        { english: 'worried', hebrew: 'דאוג', pronunciation: '/ˈwɜːrid/', emoji: '😟' }
                    ],
                    weather: [
                        { english: 'sunny', hebrew: 'שמשי', pronunciation: '/ˈsʌni/', emoji: '☀️' },
                        { english: 'rainy', hebrew: 'גשום', pronunciation: '/ˈreɪni/', emoji: '🌧️' },
                        { english: 'cloudy', hebrew: 'מעונן', pronunciation: '/ˈklaʊdi/', emoji: '☁️' },
                        { english: 'windy', hebrew: 'רוחני', pronunciation: '/ˈwɪndi/', emoji: '💨' },
                        { english: 'snowy', hebrew: 'מושלג', pronunciation: '/ˈsnoʊi/', emoji: '🌨️' },
                        { english: 'hot', hebrew: 'חם', pronunciation: '/hɑːt/', emoji: '🔥' },
                        { english: 'cold', hebrew: 'קר', pronunciation: '/koʊld/', emoji: '🧊' },
                        { english: 'warm', hebrew: 'חמים', pronunciation: '/wɔːrm/', emoji: '🌡️' }
                    ]
                }
            };

            initializeGame() {
                this.updateDisplay();
                this.generateAchievements();
                this.bindEvents();
                
                // Initialize audio on first interaction
                document.addEventListener('click', () => {
                    // Audio will be initialized by the inline Audio System v6.0
                }, { once: true });
            }

            bindEvents() {
                // Keyboard navigation support
                document.addEventListener('keydown', (e) => {
                    if (e.key >= '1' && e.key <= '4') {
                        const index = parseInt(e.key) - 1;
                        const buttons = document.querySelectorAll('.answer-button');
                        if (buttons[index]) {
                            buttons[index].click();
                        }
                    }
                });
            }

            startTimer() {
                this.timerInterval = setInterval(() => {
                    this.timer = Math.floor((Date.now() - this.startTime) / 1000);
                    this.updateTimerDisplay();
                }, 1000);
            }

            updateTimerDisplay() {
                const minutes = Math.floor(this.timer / 60);
                const seconds = this.timer % 60;
                const timerElement = document.getElementById('timer');
                if (timerElement) {
                    timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                }
            }

            loadNewQuestion() {
                safeExecute(() => {
                    const availableWords = this.getAvailableWords();
                    if (availableWords.length === 0) {
                        this.levelUp();
                        return;
                    }

                    this.currentWord = availableWords[Math.floor(Math.random() * availableWords.length)];
                    this.displayQuestion();
                    this.generateAnswerOptions();
                }, { context: 'loadNewQuestion' });
            }

            getAvailableWords() {
                const difficultyWords = this.wordDatabase[this.difficulty];
                const allWords = [];
                
                for (const category in difficultyWords) {
                    difficultyWords[category].forEach(word => {
                        word.category = category;
                        allWords.push(word);
                    });
                }
                
                return allWords.filter(word => 
                    !this.answeredQuestions.includes(word.english)
                );
            }

            displayQuestion() {
                const categoryElement = document.getElementById('category');
                const questionElement = document.getElementById('question');
                const pronunciationElement = document.getElementById('pronunciation');
                const visualHintElement = document.getElementById('visualHint');

                if (!this.currentWord) return;

                const categoryNames = {
                    animals: 'בעלי חיים',
                    colors: 'צבעים',
                    numbers: 'מספרים',
                    food: 'אוכל',
                    family: 'משפחה',
                    actions: 'פעולות',
                    emotions: 'רגשות',
                    weather: 'מזג אוויר'
                };

                if (categoryElement) {
                    categoryElement.textContent = categoryNames[this.currentWord.category] || this.currentWord.category;
                }

                if (questionElement) {
                    switch (this.gameMode) {
                        case 'wordMatch':
                            questionElement.textContent = `מה המילה באנגלית עבור "${this.currentWord.hebrew}"?`;
                            break;
                        case 'pictureWord':
                            questionElement.textContent = 'איזה מילה מתאימה לתמונה?';
                            break;
                        case 'pronunciation':
                            questionElement.textContent = 'איך מבטאים את המילה הזו?';
                            break;
                        case 'category':
                            questionElement.textContent = `איזו מילה שייכת לקטגוריית "${categoryNames[this.currentWord.category]}"?`;
                            break;
                    }
                }

                if (pronunciationElement) {
                    pronunciationElement.textContent = this.currentWord.pronunciation;
                    pronunciationElement.style.display = this.gameMode === 'pronunciation' ? 'block' : 'none';
                }

                if (visualHintElement) {
                    visualHintElement.textContent = this.currentWord.emoji;
                    visualHintElement.setAttribute('aria-label', `רמז חזותי: ${this.currentWord.hebrew}`);
                }
            }

            generateAnswerOptions() {
                const optionsContainer = document.getElementById('answerOptions');
                if (!optionsContainer || !this.currentWord) return;

                optionsContainer.innerHTML = '';
                
                const correctAnswer = this.currentWord.english;
                const wrongAnswers = this.getWrongAnswers(correctAnswer, 3);
                const allOptions = [correctAnswer, ...wrongAnswers];
                
                // Shuffle options
                for (let i = allOptions.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [allOptions[i], allOptions[j]] = [allOptions[j], allOptions[i]];
                }

                allOptions.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.className = 'answer-button';
                    button.textContent = option;
                    button.setAttribute('data-answer', option);
                    button.setAttribute('aria-label', `תשובה ${index + 1}: ${option}`);
                    button.onclick = () => this.checkAnswer(option);
                    optionsContainer.appendChild(button);
                });
            }

            getWrongAnswers(correctAnswer, count) {
                const allWords = this.getAvailableWords().concat(
                    Object.values(this.wordDatabase[this.difficulty])
                        .flat()
                        .filter(word => word.english !== correctAnswer)
                );
                
                const wrongAnswers = [];
                const usedAnswers = new Set([correctAnswer]);
                
                while (wrongAnswers.length < count && wrongAnswers.length < allWords.length) {
                    const randomWord = allWords[Math.floor(Math.random() * allWords.length)];
                    if (!usedAnswers.has(randomWord.english)) {
                        wrongAnswers.push(randomWord.english);
                        usedAnswers.add(randomWord.english);
                    }
                }
                
                return wrongAnswers;
            }

            checkAnswer(selectedAnswer) {
                safeExecute(() => {
                    if (!this.currentWord) return;

                    const isCorrect = selectedAnswer === this.currentWord.english;
                    const buttons = document.querySelectorAll('.answer-button');
                    
                    buttons.forEach(button => {
                        button.disabled = true;
                        if (button.getAttribute('data-answer') === this.currentWord.english) {
                            button.classList.add('correct');
                        } else if (button.getAttribute('data-answer') === selectedAnswer && !isCorrect) {
                            button.classList.add('incorrect');
                        }
                    });

                    if (isCorrect) {
                        this.handleCorrectAnswer();
                        if (window.audioManager) {
                            window.audioManager.playCorrectSound();
                        }
                    } else {
                        this.handleIncorrectAnswer();
                        if (window.audioManager) {
                            window.audioManager.playWrongSound();
                        }
                    }

                    this.answeredQuestions.push(this.currentWord.english);
                    
                    setTimeout(() => {
                        this.loadNewQuestion();
                    }, 1500);
                }, { context: 'checkAnswer' });
            }

            handleCorrectAnswer() {
                this.score += this.calculateScore();
                this.streak++;
                this.checkAchievements();
                this.updateDisplay();
                this.updateProgress();
                
                // Save daily progress
                this.dailyProgress.correctAnswers++;
                this.dailyProgress.totalQuestions++;
                this.saveDailyProgress();
            }

            handleIncorrectAnswer() {
                this.streak = 0;
                this.dailyProgress.totalQuestions++;
                this.saveDailyProgress();
                this.updateDisplay();
            }

            calculateScore() {
                let baseScore = 10;
                
                // Difficulty multiplier
                const difficultyMultiplier = {
                    beginner: 1,
                    intermediate: 1.5,
                    advanced: 2
                };
                
                // Streak bonus
                const streakBonus = Math.min(this.streak * 2, 50);
                
                // Speed bonus (faster answers get more points)
                const timeBonus = Math.max(0, 10 - Math.floor(this.timer / 10));
                
                return Math.floor(baseScore * difficultyMultiplier[this.difficulty] + streakBonus + timeBonus);
            }

            checkAchievements() {
                const achievements = [
                    { id: 'first_correct', emoji: '🎯', condition: () => this.dailyProgress.correctAnswers >= 1, name: 'התשובה הראשונה' },
                    { id: 'streak_5', emoji: '🔥', condition: () => this.streak >= 5, name: 'רצף של 5' },
                    { id: 'streak_10', emoji: '⚡', condition: () => this.streak >= 10, name: 'רצף של 10' },
                    { id: 'score_100', emoji: '💯', condition: () => this.score >= 100, name: '100 נקודות' },
                    { id: 'score_500', emoji: '🌟', condition: () => this.score >= 500, name: '500 נקודות' },
                    { id: 'level_5', emoji: '🏆', condition: () => this.level >= 5, name: 'רמה 5' },
                    { id: 'daily_10', emoji: '📚', condition: () => this.dailyProgress.correctAnswers >= 10, name: '10 תשובות נכונות היום' },
                    { id: 'perfect_category', emoji: '🎓', condition: () => this.streak >= 8, name: 'מושלם בקטגוריה' }
                ];

                achievements.forEach(achievement => {
                    if (!this.achievements[achievement.id] && achievement.condition()) {
                        this.achievements[achievement.id] = true;
                        this.showAchievementUnlock(achievement);
                        this.saveAchievements();
                    }
                });
            }

            showAchievementUnlock(achievement) {
                if (window.audioManager) {
                    window.audioManager.playLevelUpSound();
                }
                
                // Show achievement notification
                const notification = document.createElement('div');
                notification.className = 'achievement-notification';
                notification.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
                    color: #333;
                    padding: 20px 30px;
                    border-radius: 15px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    z-index: 3000;
                    text-align: center;
                    animation: achievementPop 1s ease;
                `;
                notification.innerHTML = `
                    <div style="font-size: 2em; margin-bottom: 10px;">${achievement.emoji}</div>
                    <div style="font-size: 1.2em; font-weight: bold;">הישג חדש!</div>
                    <div style="font-size: 1em;">${achievement.name}</div>
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
                
                // Add CSS for animation
                if (!document.getElementById('achievement-styles')) {
                    const style = document.createElement('style');
                    style.id = 'achievement-styles';
                    style.textContent = `
                        @keyframes achievementPop {
                            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
                            50% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
                            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }

            levelUp() {
                this.level++;
                this.answeredQuestions = [];
                
                if (window.audioManager) {
                    window.audioManager.playWinSound();
                }
                
                this.showLevelUpModal();
                this.updateDisplay();
            }

            showLevelUpModal() {
                const modal = document.getElementById('levelUpModal');
                const title = document.getElementById('levelUpTitle');
                const message = document.getElementById('levelUpMessage');
                
                if (modal && title && message) {
                    title.textContent = `עלית לרמה ${this.level}!`;
                    message.textContent = `כל הכבוד! השלמת את כל המילים ברמה הקודמת`;
                    modal.style.display = 'flex';
                    
                    // Focus management for accessibility
                    modal.focus();
                }
            }

            updateDisplay() {
                safeExecute(() => {
                    const scoreElement = document.getElementById('score');
                    const levelElement = document.getElementById('level');
                    const streakElement = document.getElementById('streak');
                    const streakTextElement = document.getElementById('streakText');
                    
                    if (scoreElement) scoreElement.textContent = this.score.toLocaleString();
                    if (levelElement) levelElement.textContent = this.level;
                    if (streakElement) streakElement.textContent = this.streak;
                    if (streakTextElement) streakTextElement.textContent = `רצף נכון: ${this.streak}`;
                }, { context: 'updateDisplay' });
            }

            updateProgress() {
                const totalQuestions = Object.values(this.wordDatabase[this.difficulty]).flat().length;
                const progress = Math.min((this.answeredQuestions.length / totalQuestions) * 100, 100);
                
                const progressFill = document.getElementById('progressFill');
                if (progressFill) {
                    progressFill.style.width = `${progress}%`;
                    progressFill.parentElement.setAttribute('aria-valuenow', progress);
                }
            }

            generateAchievements() {
                const achievementsContainer = document.getElementById('achievements');
                if (!achievementsContainer) return;
                
                const achievementsList = [
                    { id: 'first_correct', emoji: '🎯' },
                    { id: 'streak_5', emoji: '🔥' },
                    { id: 'streak_10', emoji: '⚡' },
                    { id: 'score_100', emoji: '💯' },
                    { id: 'score_500', emoji: '🌟' },
                    { id: 'level_5', emoji: '🏆' },
                    { id: 'daily_10', emoji: '📚' },
                    { id: 'perfect_category', emoji: '🎓' }
                ];
                
                achievementsContainer.innerHTML = '';
                achievementsList.forEach(achievement => {
                    const badge = document.createElement('div');
                    badge.className = `achievement ${this.achievements[achievement.id] ? 'unlocked' : ''}`;
                    badge.textContent = achievement.emoji;
                    badge.setAttribute('aria-label', `הישג: ${achievement.id}`);
                    achievementsContainer.appendChild(badge);
                });
            }

            loadDailyProgress() {
                const today = new Date().toDateString();
                const saved = safeStorage('dailyProgress');
                
                if (saved) {
                    const progress = safeJSON(saved, {});
                    if (progress.date === today) {
                        return progress;
                    }
                }
                
                return {
                    date: today,
                    correctAnswers: 0,
                    totalQuestions: 0,
                    timeSpent: 0
                };
            }

            saveDailyProgress() {
                safeStorage('dailyProgress', this.dailyProgress);
            }

            loadAchievements() {
                const saved = safeStorage('achievements');
                return saved ? safeJSON(saved, {}) : {};
            }

            saveAchievements() {
                safeStorage('achievements', this.achievements);
            }
        }

        // Global functions for UI interactions
        function setDifficulty(difficulty) {
            safeExecute(() => {
                if (window.game) {
                    window.game.difficulty = difficulty;
                    window.game.answeredQuestions = [];
                    window.game.loadNewQuestion();
                }
                
                // Update UI
                document.querySelectorAll('.difficulty-button').forEach(btn => {
                    btn.classList.remove('active');
                    btn.setAttribute('aria-pressed', 'false');
                });
                
                const activeButton = event ? event.target : document.querySelector(`[onclick*="${difficulty}"]`);
                if (activeButton) {
                    activeButton.classList.add('active');
                    activeButton.setAttribute('aria-pressed', 'true');
                }
                
                if (window.audioManager) {
                    window.audioManager.playClickSound();
                }
            }, { context: 'setDifficulty' });
        }

        function setGameMode(mode) {
            safeExecute(() => {
                if (window.game) {
                    window.game.gameMode = mode;
                    window.game.loadNewQuestion();
                }
                
                // Update UI
                document.querySelectorAll('.mode-button').forEach(btn => {
                    btn.classList.remove('active');
                    btn.setAttribute('aria-pressed', 'false');
                });
                
                const activeButton = event ? event.target : document.querySelector(`[onclick*="${mode}"]`);
                if (activeButton) {
                    activeButton.classList.add('active');
                    activeButton.setAttribute('aria-pressed', 'true');
                }
                
                if (window.audioManager) {
                    window.audioManager.playClickSound();
                }
            }, { context: 'setGameMode' });
        }

        function closeLevelUpModal() {
            const modal = document.getElementById('levelUpModal');
            if (modal) {
                modal.style.display = 'none';
            }
            
            if (window.audioManager) {
                window.audioManager.playClickSound();
            }
        }

        // Initialize game when page loads
        window.addEventListener('DOMContentLoaded', () => {
            safeExecute(() => {
                window.game = new HebrewEnglishGame();
            }, { context: 'gameInitialization' });
        });

        // Handle visibility change to pause/resume game
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // Game is hidden, save progress
                if (window.game) {
                    window.game.saveDailyProgress();
                    window.game.saveAchievements();
                }
            }
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (window.game) {
                window.game.saveDailyProgress();
                window.game.saveAchievements();
                if (window.game.timerInterval) {
                    clearInterval(window.game.timerInterval);
                }
            }
        });

        console.log('🎓 Hebrew-English Learning Game initialized | Educational | Accessible | Fun for all ages');
    </script>
</body>
</html>